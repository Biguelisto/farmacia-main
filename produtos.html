<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm√°cia Digital - Produtos</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Estilos tempor√°rios para debug */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body class="produtos">
    <div class="debug-info" id="debugInfo"></div>
    
    <div class="bannerProdutos">
        <div class="logo-container">
            <a href="#" class="logo">
                <i class="fas fa-prescription-bottle-alt logo-icon"></i>
                Farm√°cia Digital
            </a>
        </div>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar produtos..." autocomplete="off">
            <button id="searchButton">Buscar</button>
        </div>
        
        <!-- üîπ MENU DE CATEGORIAS (AGORA DIN√ÇMICO) -->
        <div class="categories-container">
            <button class="category-btn active" data-category="all">Todos</button>
            <!-- Bot√µes de categoria ser√£o gerados via JavaScript -->
        </div>
    </div>
        
    <div class="container">  
        <div class="product-grid" id="productGrid">
            <!-- Produtos ser√£o carregados via JavaScript -->
        </div>
        
        <div class="cart-container">
            <div class="cart-header">
                <div class="cart-title">Seu Carrinho</div>
                <div class="cart-count">0</div>
            </div>
            <div class="cart-items" id="cartItems">
                <div class="empty-cart">Seu carrinho est√° vazio</div>
            </div>
            <div class="cart-total">Total: R$ 0,00</div>
            <a href="checkout.html" class="checkout-btn" id="checkoutBtn">Finalizar Compra</a>
        </div>
    </div>
    
    <footer>
        <p>Drogaria Pharma Life ¬© <span id="year"></span> - Atendimento Autom√°tico</p>
        
        <!-- Bot√£o de contato (WhatsApp) -->
        <div class="contact-container">
            <a href="https://wa.me/5521990699910" 
               class="contact-button" 
               target="_blank" 
               rel="noopener noreferrer">
               üìû Falar no WhatsApp
            </a>
        </div>
    </footer>

    <script>
        // ===== SISTEMA DE PRODUTOS BASE =====
        const products = [
            { id: 1, name: "Paracetamol 500mg 10 comprimidos", price: 8.99, category: "Dor de cabe√ßa", image: "https://cdn1.staticpanvel.com.br/produtos/15/105567-15.jpg?ims=424x" },
            { id: 2, name: "Dipirona S√≥dica 500mg 10 comprimidos", price: 6.50, category: "Dor de cabe√ßa", image: "https://promofarma.vtexassets.com/arquivos/ids/172457/Captura-de-tela-2024-05-24-154053.png?v=638521728895100000" },
            { id: 3, name: "Ibuprofeno 400mg 10 comprimidos", price: 12.90, category: "Anti inflamat√≥rios", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT6hAYJeK41lEVgrTnyoM9BdRBSZlLDBorHGQ&s" },
            { id: 4, name: "Omeprazol 20mg 14 c√°psulas", price: 15.75, category: "Est√¥mago", image: "https://product-data.raiadrogasil.io/images/14966168.webp" },
            { id: 5, name: "Dorflex 10 comprimidos", price: 9.80, category: "Dores Musculares", image: "https://drogariasp.vteximg.com.br/arquivos/ids/1113365-1000-1000/59790---Dorflex-Analgesico-e-Relaxante-Muscular-10-comprimidos_0003_Layer-1.png?v=638525165409700000" },
            { id: 7, name: "Band-Aid Caixa com 30 unidades", price: 14.20, category: "Primeiros Socorros", image: "https://io.convertiez.com.br/m/farmaponte/shop/products/images/21988/medium/curativo-band-aid-aquablock-30-unidades_14998.jpg" },
            { id: 8, name: "Protetor Solar FPS 50 120ml", price: 45.90, category: "Cuidados Pessoais", image: "https://drogariascampea.vtexassets.com/arquivos/ids/167372-800-800?v=638126663437130000&width=800&height=800&aspect=true" },
            { id: 9, name: "Sabonete L√≠quido Antibacteriano 250ml", price: 12.40, category: "Higiene", image: "https://drogariasp.vteximg.com.br/arquivos/ids/529669-1000-1000/146013---sabonete-liquido-antibacteriano-corporal-protex-balance-250ml.jpg?v=637792349965300000" },
            { id: 10, name: "Shampoo Anticaspa 200ml", price: 22.50, category: "Higiene", image: "https://product-data.raiadrogasil.io/images/13158341.webp" },
            { id: 11, name: "Condicionador Hidratante 200ml", price: 24.90, category: "Higiene", image: "https://acdn-us.mitiendanube.com/stores/003/130/602/products/9-c479078fd3c9ff4ecc17110314535466-640-0.png" },
            { id: 12, name: "Creme Dental 90g", price: 4.99, category: "Higiene", image: "https://drogariavenancio.vtexassets.com/arquivos/ids/1131498-800-450?v=638463595222500000&width=800&height=450&aspect=true" }
        ];

        // ===== SISTEMA DE ADMINISTRA√á√ÉO =====
        // Fun√ß√µes para gerenciar produtos e categorias no localStorage
        function getCustomProducts() { 
            return JSON.parse(localStorage.getItem('customProducts') || '[]'); 
        }

        function setCustomProducts(data) { 
            localStorage.setItem('customProducts', JSON.stringify(data)); 
        }

        function getCustomCategories() { 
            return JSON.parse(localStorage.getItem('customCategories') || '[]'); 
        }

        function setCustomCategories(data) { 
            localStorage.setItem('customCategories', JSON.stringify(data)); 
        }

        // Obter todos os produtos (base + personalizados)
        function getAllProducts() {
            const base = [...products];
            const custom = getCustomProducts().map(p => ({ 
                ...p, 
                id: p.id || Date.now() + Math.random() 
            }));
            return [...base, ...custom];
        }

        // Obter todas as categorias
        function getAllCategories() {
            const cats = new Set();
            
            // Adicionar categorias dos produtos base
            products.forEach(p => cats.add(p.category));
            
            // Adicionar categorias dos produtos personalizados
            getCustomProducts().forEach(p => cats.add(p.category));
            
            // Adicionar categorias personalizadas adicionais
            getCustomCategories().forEach(c => cats.add(c));
            
            return Array.from(cats);
        }

        // ===== P√ÅGINA DE PRODUTOS =====
        const productGrid = document.getElementById('productGrid');
        const cartItems = document.getElementById('cartItems');
        const cartCount = document.querySelector('.cart-count');
        const cartTotal = document.querySelector('.cart-total');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const debugInfo = document.getElementById('debugInfo');

        // Carrinho de compras
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentCategory = 'all';

        // Fun√ß√£o para salvar o carrinho no localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Fun√ß√£o para gerar um n√∫mero de senha aleat√≥rio
        function generateTicketNumber() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            const randomLetter = letters.charAt(Math.floor(Math.random() * letters.length));
            const randomNumbers = numbers.charAt(Math.floor(Math.random() * 10)) + 
                                 numbers.charAt(Math.floor(Math.random() * 10)) + 
                                 numbers.charAt(Math.floor(Math.random() * 10));
            return `${randomLetter}-${randomNumbers}`;
        }

        // Fun√ß√£o para renderizar categorias
        function renderCategories() {
            const categoriesContainer = document.querySelector('.categories-container');
            if (!categoriesContainer) return;
            
            // Manter apenas o bot√£o "Todos"
            categoriesContainer.innerHTML = '<button class="category-btn active" data-category="all">Todos</button>';
            
            // Adicionar bot√µes para cada categoria
            getAllCategories().forEach(category => {
                // N√£o duplicar o bot√£o "Todos"
                if (category !== 'all') {
                    const button = document.createElement('button');
                    button.className = 'category-btn';
                    button.setAttribute('data-category', category);
                    button.textContent = category;
                    categoriesContainer.appendChild(button);
                }
            });
            
            // Adicionar event listeners aos bot√µes
            categoriesContainer.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const category = e.target.getAttribute('data-category');
                    filterByCategory(category);
                });
            });
        }

        // Fun√ß√£o para filtrar produtos por categoria
        function filterByCategory(category) {
            currentCategory = category;
            
            // Atualizar bot√£o ativo
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });
            
            // Filtrar produtos
            if (category === 'all') {
                renderProducts(getAllProducts());
            } else {
                const filteredProducts = getAllProducts().filter(product => 
                    product.category === category
                );
                renderProducts(filteredProducts);
            }
        }

        // Renderizar produtos
        function renderProducts(productsToRender = getAllProducts()) {
            if (!productGrid) return;
            
            productGrid.innerHTML = '';
            
            if (productsToRender.length === 0) {
                productGrid.innerHTML = '<div class="no-products">Nenhum produto encontrado</div>';
                return;
            }
            
            productsToRender.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="add-to-cart" data-id="${product.id}">Adicionar ao Carrinho</button>
                `;
                productGrid.appendChild(productCard);
            });
            
            // Adicionar event listeners aos bot√µes
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', addToCart);
            });
        }
        
        // Adicionar produto ao carrinho
        function addToCart(e) {
            const productId = parseInt(e.target.getAttribute('data-id'));
            const product = getAllProducts().find(p => p.id === productId);
            
            if (!product) return;
            
            // Verificar se o produto j√° est√° no carrinho
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            
            saveCart();
            updateCart();
            
            // Feedback visual
            e.target.textContent = 'Adicionado!';
            e.target.style.backgroundColor = '#28a745';
            setTimeout(() => {
                e.target.textContent = 'Adicionar ao Carrinho';
                e.target.style.backgroundColor = '#0078d7';
            }, 1000);
        }
        
        // Atualizar carrinho
        function updateCart() {
            // Atualizar contador
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (cartCount) cartCount.textContent = totalItems;
            
            // Atualizar lista de itens
            if (cart.length === 0) {
                if (cartItems) cartItems.innerHTML = '<div class="empty-cart">Seu carrinho est√° vazio</div>';
                if (checkoutBtn) checkoutBtn.style.display = 'none';
            } else {
                if (cartItems) {
                    cartItems.innerHTML = '';
                    cart.forEach(item => {
                        const cartItem = document.createElement('div');
                        cartItem.className = 'cart-item';
                        cartItem.innerHTML = `
                            <div class="cart-item-name">${item.name} (x${item.quantity})</div>
                            <div class="cart-item-price">R$ ${(item.price * item.quantity).toFixed(2)}</div>
                        `;
                        cartItems.appendChild(cartItem);
                    });
                }
                if (checkoutBtn) checkoutBtn.style.display = 'block';
            }
            
            // Atualizar total
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            if (cartTotal) cartTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
            
            // Atualizar estado do bot√£o de checkout
            if (checkoutBtn) checkoutBtn.classList.toggle('disabled', cart.length === 0);
        }
        
        // Fun√ß√£o para pesquisar produtos (atualizada para considerar categoria)
        function searchProducts() {
            const searchTerm = searchInput.value.toLowerCase();
            
            let filteredProducts;
            
            if (currentCategory === 'all') {
                filteredProducts = getAllProducts().filter(product => 
                    product.name.toLowerCase().includes(searchTerm)
                );
            } else {
                filteredProducts = getAllProducts().filter(product => 
                    product.category === currentCategory && 
                    product.name.toLowerCase().includes(searchTerm)
                );
            }
            
            renderProducts(filteredProducts);
        }
        
        // Event listeners
        if (searchButton) searchButton.addEventListener('click', searchProducts);
        if (searchInput) searchInput.addEventListener('input', searchProducts);
        
        // Debug: mostrar informa√ß√µes no console
        function showDebugInfo() {
            console.log('=== DEBUG INFO ===');
            console.log('Produtos base:', products.length);
            console.log('Produtos personalizados:', getCustomProducts().length);
            console.log('Total de produtos:', getAllProducts().length);
            console.log('Categorias:', getAllCategories());
            console.log('Carrinho:', cart);
            
            // Mostrar info na tela (opcional)
            debugInfo.innerHTML = `
                Produtos: ${getAllProducts().length}<br>
                Categorias: ${getAllCategories().length}<br>
                Carrinho: ${cart.length} itens
            `;
            debugInfo.style.display = 'block';
        }

        // Inicializar
        renderCategories();
        renderProducts();
        updateCart();
        showDebugInfo();

        // Ano autom√°tico
        document.getElementById("year").textContent = new Date().getFullYear();
    </script>
</body>
</html>